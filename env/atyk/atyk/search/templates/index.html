{% extends "basic_generic.html" %}
{% block content %}
    
            <div class="container-fluid"  id="starting"><a class="btn btn-link" role="button" href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars"></i></a>
                <div class="row">
                    <div class="col-md-12">
                        <div>
                            <h1>Ask To Your Kitchen</h1>
                            <p>Buscador de Recetas con un toque distinto.</p>
                        </div>
                    </div>
                </div>
                <div class="row" id="addcoroto">
                    <div class="col-md-12 col-lg-4"> <!-- buscar el codigo del contador en PU-->
                        <div>
                            <!-- <input v-model="input.ingrd" /> -->
                            <h1>Ingredientes</h1>
                            <input v-model="pared" type="text-area" @focus="showMessage()">
                            <input id="lleva" type="hidden">                          

                            <!-- <ul>
                                <li v-for="chichi in chichis" style="list-style: none">
                                    ${chichi.ingrd}
                                    
                                </li>
                            </ul> -->
                            
                            <!-- <input v-model="input.ingrd" />
                            <a class="btn" href="javascript:void(0)" @click="addNewUser">Agregar Ingrediente</a>
                             -->
                             <p v-show="focus == true">Ingrese los ingredientes, separados por una coma ( , )</p>
                        </div>
                        
                    </div>
                    
                    <div class="col-lg-4">
                        <div>
                            <h1>Condiciones</h1>
                            <div class="form-check"><input class="form-check-input" type="checkbox" id="formCheck-1"><label class="form-check-label" for="formCheck-1">Celiaco</label></div>
                            <div class="form-check"><input class="form-check-input" type="checkbox" id="formCheck-2"><label class="form-check-label" for="formCheck-2">Intolerante a la Lactosa</label></div>
                            <div class="form-check"><input class="form-check-input" type="checkbox" id="formCheck-3"><label class="form-check-label" for="formCheck-3">Alergia a las Nueces</label></div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div>
                            <h1>Categor√≠a</h1><select><optgroup label="This is a group"><option value="12" selected="">This is item 1</option><option value="13">This is item 2</option><option value="14">This is item 3</option></optgroup></select></div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-4"></div>
                    <div class="col-lg-4"><button class="btn btn-primary" type="button" style="width:100%;height:100%;"  @click='mandarria()'>Buscar</button></div>
                    <div class="col-lg-4"></div>
                </div>
                <div class="row">
                    <div class="col">
                        <h1>Te Ofrecemos Estas Recetas</h1>
                        <ul v-show="gotresultp == true">
                            <a v-bind:href="'/search/receta/'+ fukingid"> ${recetaSelect}          
                        </ul>
                        <h3 v-show="gotresultn == true">Lo sentimos, no hay recetas con los parametros ingresados</h3>
                    </div>
                </div>
            </div>
        
<!-- vue.js files -->
<script src="https://cdn.jsdelivr.net/npm/vue@2.5.13/dist/vue.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue-resource@1.3.5"></script>
<script type="text/javascript">
  
  Vue.http.headers.common['X-CSRFToken'] = "{{ csrf_token }}";
  new Vue({
    el: '#starting',
    delimiters: ['${','}'],
    data: {
        recetas: [],
        loading: true,
        currentReceta: {},
        message: null,
        newReceta: { 'nombre': null, 'ingredientes':null, 'preparacion': null, 'tiempo_preparacion':null, 'metodo_coccion':null },
        rows: [],
        search_term: '',
        pared: '',
        count: '',
        focus: false,
        recetaSelect: '',
        gotresultp: false,
        gotresultn: false,
        fukingid: '',
        chichis: [],
        counter: 0
    },
    created: function() {
      this.getRecetas();
    },
    methods: {
        showMessage() {
            this.focus = true;
        },
        mandarria() {
            document.getElementById("lleva").value = this.pared; //obtengo los valores del input "lleva"
            this.tumama = this.pared.split(", ", 20); //divido el string "lleva" y lo guardo en tu mama
            
            this.getRecetas(this.tumama); //invoco a getrecetas con el parametro this.tumama

        },
        getRecetas: function($cualquier) { //recibo el parametro this.tumama y lo rebautizo "$cualquier"
    
        let api_url = '/api/addreceta/';
        if(this.search_term!==''||this.search_term!==null) {
          api_url = `/api/addreceta/?search=${this.search_term}`
        }
        this.loading = true;
        this.$http.get(api_url)
            .then((response) => {
              this.recetas = response.data;
              this.loading = false;
                
            })
            .catch((err) => {
              this.loading = false;
              console.log(err);
            })
            
            
            for (let i = 0; i < this.recetas.length; i++) { //conteo por cada receta
                
                this.otraopcion = this.recetas[i].ingredientes; //guardo en esta variable, el array de ingredientes en la primera posicion de recetas.

                this.fuck = this.otraopcion.split(", "); //divide el array de ingredientes, separados por coma (,)

                this.fucksorted = this.fuck.sort(); //ordena por orden alfabetico los elementos del array this.fuck

                this.cualquiersorted = $cualquier.sort(); //organiza el array de ingredientes que introduce el usuario

                if (this.fuck.length === $cualquier.length) { //cuando encuentre que los arrays tienen exactamente la misma longitud de caracteres, se parara
                    
                    for (let j = 0; j < this.fucksorted.length; j++) { 
                        
                        if (this.fucksorted[j] === this.cualquiersorted[j]) {
                           this.counter += 1;
                        } 
                    }
                    if (this.counter === this.fuck.length){
                        this.recetaSelect = this.recetas[i].nombre;
                        this.fukingid = this.recetas[i].id;
                        this.gotresultp = true;
                        console.log(this.recetaSelect)
                    }
                    // } else {
                    //     this.gotresultn = true;
                    //     console.log('BUUUUU :(')
                    // }
                } 
                
                
            } 
        }
    }
  });
</script> 

{% endblock %}

